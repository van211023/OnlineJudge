import{e}from"./index.437ff7e1.js";import{d as t,g as n,z as a,_ as o,r as s,o as r,c as l,b as c,k as u,j as i,m as d,t as g}from"./vendor.89c38d11.js";import"./dateformat.2852d5e6.js";const p={style:{margin:"0 2em"}};var m=t({props:{contestId:{type:String,default:""}},setup(t){const m=t;let f=n([]);function w(e){let t=new Date(e);return t.getFullYear()+"-"+((t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-")+(t.getDate()<10?"0"+t.getDate():t.getDate())+" "+((t.getHours()<10?"0"+t.getHours():t.getHours())+":")+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())}let v=null,b=null;var S=document.location.hostname,y=document.location.port,D="";function h(e){return 100==e?"通过":200==e?"执行错误":300==e?"解答错误":900==e?"正在判题中":"未知异常:"+e}function k(e){return 100==e?"success":200==e||300==e?"danger":900==e?"info":"warning"}function I(){console.log("websocket连接成功")}function E(e){let t=JSON.parse(e.data),n=t.status;f.value=[{Date:w(t.uploadTime),User:t.userName,expName:t.expName,Status:n,StatusDescr:t.statusDescr,tagType:k(n),tagContent:h(n)}]}function L(e){console.log(e,"通信发生错误"),x()}function N(e){console.log(e,"websocket关闭"),x()}function x(){null!=v&&(v.removeEventListener("open",I),v.removeEventListener("message",E),v.removeEventListener("error",L),v.removeEventListener("close",N),v.close(),v=null),clearInterval(b)}return D="localhost"==S?"ws://127.0.0.1:"+y.toString()+"/OnlineJudge/websocket/"+window.localStorage.getItem("name"):"ws://"+S.toString()+":"+y.toString()+"/OnlineJudge/websocket/"+window.localStorage.getItem("name"),a((async()=>{let t=new Object;t.data={contestId:String(m.contestId)};let n=(await e(t)).data,a=n.status;console.log(n),null!=a&&(f.value=[{Date:w(n.uploadTime),User:n.userName,expName:n.expName,Status:a,StatusDescr:n.statusDescr,tagType:k(a),tagContent:h(a)}]),"undefined"==typeof WebSocket&&o({message:"抱歉，您的浏览器不支持websocket",type:"error",duration:5e3}),function(){null!==v&&v.close();v=new WebSocket(D),v.addEventListener("open",I),v.addEventListener("message",E),v.addEventListener("error",L),v.addEventListener("close",N),clearInterval(b),b=setInterval((()=>{1===v.readyState?clearInterval(b):console.log("无法建立websocket连接")}),3e3)}()})),window.onbeforeunload=function(){x()},(e,t)=>{const n=s("el-table-column"),a=s("el-tag"),o=s("el-table");return r(),l("div",null,[c("div",p,[c(o,{data:u(f),style:{width:"100%"}},{default:i((()=>[c(n,{prop:"Date",label:"日期",align:"center",width:"150"}),c(n,{prop:"User",label:"用户名",align:"center",width:"150"}),c(n,{prop:"expName",label:"实验名称",align:"center",width:"200"}),c(n,{prop:"Status",label:"作业状态",align:"center",width:"150"},{default:i((e=>[c(a,{type:e.row.tagType,effect:"dark"},{default:i((()=>[d(g(e.row.tagContent),1)])),_:2},1032,["type"])])),_:1}),c(n,{prop:"StatusDescr",label:"描述",align:"center"})])),_:1},8,["data"])])])}}});export default m;
