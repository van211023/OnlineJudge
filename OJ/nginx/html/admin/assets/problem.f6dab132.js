import{p as e}from"./paginationlogic.22ec78bb.js";import"./index.4d66c970.js";import{_ as t}from"./notification.8e3fe923.js";import{d as l,r as a,b as o,c as i,i as d,k as n,A as r,F as s,l as p,n as m,a as u,g as c,p as g,e as b,h as f}from"./vendor.e45b1972.js";const h=p();g("data-v-306e3b22");const y={class:"dialog-footer"},S=m("关 闭"),V=m("添 加"),I=m("添加题目"),w=m("保存更改"),v=m("删除");b();var L=l({expose:[],props:{contestId:{type:String,default:""}},setup(l){const p=l;let m=a([]),{currentPage:g,pageCount:b,pageSize:L,pageSizes:_,handlePage:x,handlePageSize:z,refresh:C}=e(m,{dataUrl:"admin/contest/problem/list",otherParams:{contestId:p.contestId}});function U(){u.post("admin/contest/problem/update",{data:{contestId:p.contestId,list:m.value.map((e=>({memoryLimit:e.memoryLimit.toString(),problemId:e.problemId.toString(),timeLimit:e.timeLimit.toString(),timeLimitSpc:e.timeLimitSpc.toString(),title:e.title.toString()})))}}).then((()=>t({title:"成功",message:"修改成功",type:"success"})))}o(C),a();let k=a(!1),j=a([]),P=a([]);async function F(){console.log(j.value);let e=Object.values(j.value).map((e=>u.post("admin/contest/problem/add",{data:{problemId:e.toString(),contestId:p.contestId}}).catch((l=>{throw t({title:"失败",message:`添加Problem ${e}失败`,type:"error"}),l}))));try{await Promise.all(e),t({title:"成功",message:"全部添加成功",type:"success"})}catch{}finally{j.value=[],k.value=!1,C()}}async function $(){k.value=!0;let e=(await u.get("admin/problem/list?page=1&limit=15")).data.count;P.value=(await u.get(`admin/problem/list?page=1&limit=${e}`)).data.list.map((e=>({key:e.problemId,label:e.title,disabled:-1!==m.value.findIndex((t=>t.problemId==e.problemId))})))}return(e,l)=>{const a=c("el-transfer"),o=c("el-button"),C=c("el-dialog"),A=c("el-table-column"),D=c("el-input"),M=c("el-table"),O=c("el-pagination");return f(),i(s,null,[d(C,{title:"添加题目",width:"60%",modelValue:n(k),"onUpdate:modelValue":l[3]||(l[3]=e=>r(k)?k.value=e:k=e)},{footer:h((()=>[d("span",y,[d(o,{onClick:l[2]||(l[2]=e=>r(k)?k.value=!1:k=!1)},{default:h((()=>[S])),_:1}),d(o,{type:"primary",onClick:F},{default:h((()=>[V])),_:1})])])),default:h((()=>[d(a,{modelValue:n(j),"onUpdate:modelValue":l[1]||(l[1]=e=>r(j)?j.value=e:j=e),filterable:"","filter-placeholder":"搜索",data:n(P),style:{width:"fit-content",margin:"0 auto"},titles:["题目列表","添加题目"]},null,8,["modelValue","data"])])),_:1},8,["modelValue"]),d("span",null,[d(o,{size:"small",icon:"el-icon-plus",type:"primary",onClick:$},{default:h((()=>[I])),_:1}),d(o,{size:"small",icon:"el-icon-upload",type:"success",onClick:U},{default:h((()=>[w])),_:1})]),d(M,{class:"editable",data:n(m),style:{width:"100%",height:"calc(100vh - 175px)","margin-top":"0.6em","margin-bottom":"5px"},height:"style.height","cell-style":{padding:"2px 0px"},"header-cell-style":{padding:"8px 0px"},stripe:"",border:!0,fit:""},{default:h((()=>[d(A,{sortable:"",fixed:"",prop:"problemId",label:"ID",width:"65"}),d(A,{fixed:"",prop:"title",label:"标题",width:"220"},{default:h((e=>[d(D,{modelValue:e.row.title,"onUpdate:modelValue":t=>e.row.title=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),d(A,{prop:"timeLimit",label:"时限(S)"},{default:h((e=>[d(D,{modelValue:e.row.timeLimit,"onUpdate:modelValue":t=>e.row.timeLimit=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),d(A,{prop:"timeLimitSpc",label:"特别时限(S)"},{default:h((e=>[d(D,{modelValue:e.row.timeLimitSpc,"onUpdate:modelValue":t=>e.row.timeLimitSpc=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),d(A,{prop:"memoryLimit",label:"内存限制(M)"},{default:h((e=>[d(D,{modelValue:e.row.memoryLimit,"onUpdate:modelValue":t=>e.row.memoryLimit=t},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),d(A,{prop:"isSpj",label:"是否特判"}),d(A,{prop:"addTime",label:"题目添加时间"}),d(A,{prop:"judgeFiles",label:"评测数据组数"}),d(A,{fixed:"right",prop:"",label:"操作",width:"70"},{default:h((e=>[d(o,{type:"danger",size:"mini",onClick:l=>async function(e){try{await u.post("admin/contest/problem/delete",{data:{problemId:e.toString(),contestId:p.contestId.toString()}}),t({title:"成功",message:"删除成功",type:"success"}),x(g.value)}catch{t({title:"失败",message:"删除失败",type:"error"})}}(e.row.problemId)},{default:h((()=>[v])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),d(O,{background:"",onSizeChange:n(z),onCurrentChange:n(x),"current-page":n(g),"page-sizes":n(_),"page-size":n(L),layout:"total, sizes, prev, pager, next, jumper",total:n(b)},null,8,["onSizeChange","onCurrentChange","current-page","page-sizes","page-size","total"])],64)}}});L.__scopeId="data-v-306e3b22";export default L;
