import{_ as e}from"./notification.8e3fe923.js";import"./dateformat.2852d5e6.js";import{d as t,b as n,r as o,c as a,i as l,D as s,F as r,g as i,h as c,n as u}from"./vendor.e45b1972.js";const d=l("br",null,null,-1),p=l("p",null,"1.先点击连接按钮连接查重websocket",-1),g=l("p",null,"2.提示weboscket连接成功后，点击查重按钮开始查重",-1),b=u("建立webSocket连接"),f=u("查重"),m=l("br",null,null,-1),w=l("p",null,"下方显示查重状态:",-1),v=l("a",{id:"a"},null,-1);var k=t({expose:[],props:{contestId:{type:String,default:""}},setup(t){const u=t;function k(){null==L||1!=L.readyState?e({title:"错误",message:"请先建立websocket连接",type:"error"}):1==L.readyState&&L.send(u.contestId)}n((()=>{y.value.innerHTML="查重未开始"}));let y=o(),L=null,S=null;var h=document.location.hostname,I=document.location.port,E="";function M(){null==L?T():1==L.readyState?e({title:"成功",message:"websocket已经连接成功",type:"success",duration:5e3}):T()}function H(){null!=L&&L.close(),L=new WebSocket(E),L.addEventListener("open",A),L.addEventListener("message",C),L.addEventListener("error",j),L.addEventListener("close",O)}function T(){H(),clearInterval(S),S=setInterval((()=>{1==L.readyState?clearInterval(S):(console.log("无法建立websocket连接"),e({title:"失败",message:"websocket连接失败，3s后尝试重连",type:"error"}),H())}),3e3)}function A(){console.log("websocket连接成功"),e({title:"成功",message:"websocket连接成功，点击查重按钮后开始查重本次实验",type:"success",duration:5e3})}function C(t){let n=JSON.parse(t.data);var o,a,l;console.log(n.status),"begin"==n.status?y.value.innerHTML="正在查重中":"end"==n.status?(o=n.info,a="result.zip",l=function(e){for(var t=e.split(","),n="data:application/zip;base64".match(/:(.*?);/)[1],o=atob(t),a=o.length,l=new Uint8Array(a);a--;)l[a]=o.charCodeAt(a);return new Blob([l],{type:n})}(o),function(e,t){var n=document.getElementById("a");n.setAttribute("href",e),n.setAttribute("download",t),n.setAttribute("target","_blank"),n.innerHTML="查重结果",document.createEvent("MouseEvents").initEvent("click",!0,!0)}(URL.createObjectURL(l),a),y.value.innerHTML="查重已结束，点击下方下载结果。解压后，点开其中的index.html即可查看"):"error"==n.status?y.value.innerHTML=`后端查重报错：${n.info}`:"warning"==n.status?e({title:"警告",message:`${n.info}`,type:"warning",duration:5e3}):y.value.innerHTML=`无法解析后端发回的消息：${t.data}`}function j(t){console.log(t,"通信发生错误"),e({title:"错误",message:`websocket通信发生错误: ${t}`,type:"error"}),y.value.innerHTML="websocket通信发生错误，请打开控制台查看具体信息"}function O(e){console.log(e,"websocket关闭"),clearInterval(S)}return E="localhost"==h?"ws://127.0.0.1:"+I.toString()+"/OnlineJudge/dupCheck/"+window.localStorage.getItem("name"):"ws://"+h.toString()+":"+I.toString()+"/OnlineJudge/dupCheck/"+window.localStorage.getItem("name"),window.onbeforeunload=function(){null!=L&&L.close()},(e,t)=>{const n=i("el-button");return c(),a(r,null,[d,p,g,l("p",null,[l(n,{type:"primary",onClick:M},{default:s((()=>[b])),_:1}),l(n,{type:"success",onClick:k},{default:s((()=>[f])),_:1})]),m,w,l("p",{ref:y},null,512),v],64)}}});export default k;
